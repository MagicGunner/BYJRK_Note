<Window
    x:Class="ItemsControlDemo.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="clr-namespace:ItemsControlDemo.ValueConverters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ItemsControlDemo"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="MainWindow"
    Width="1270"
    Height="800"
    d:DataContext="{d:DesignInstance local:MainWindowViewModel,
                                     IsDesignTimeCreatable=True}"
    SizeToContent="Height"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.Resources>
        <local:EmployeeTemplateSelector x:Key="EmployeeTemplateSelector" />
        <conv:OrdinalIndexConverter x:Key="OrdinalIndexConverter" />
        <conv:CollectionElementIndexConverter x:Key="CollectionElementIndexConverter" />
        <conv:ItemIndexConverter x:Key="IndexConverter" />
        <conv:PreviousIndexConverter x:Key="PreviousIndexConverter"></conv:PreviousIndexConverter>
    </Window.Resources>
    <TabControl>

        <!--  第三节课，如何保证前一节课后两种方法中元素删除序号不更新的问题  -->
        <TabItem Header="ItemsControl2">
            <DockPanel>
                <Button
                    Width="200"
                    Height="70"
                    HorizontalAlignment="Left"
                    Command="{Binding RemoveCommand}"
                    Content="Remove"
                    DockPanel.Dock="Bottom" />
                <TabControl>
                    <TabItem Header="Model">
                        <ListBox
                            Padding="5"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            VerticalAlignment="Center">
                                            <TextBlock.Text>
                                                <MultiBinding Converter="{StaticResource PreviousIndexConverter}"
                                                              StringFormat="{}{0}">
                                                    <Binding></Binding>
                                                    <Binding RelativeSource="{RelativeSource PreviousData}" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem Header="Model">
                        <ListBox
                            Padding="5"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            VerticalAlignment="Center" Text="{Binding Index}">
                                        </TextBlock>
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem Header="Indexes">
                        <ListBox
                            Padding="5"
                            ItemsSource="{Binding Items}">
                            <ListBox.Template>
                                <ControlTemplate TargetType="ListBox">
                                    <ScrollViewer>
                                        <DockPanel>
                                            <ItemsControl DockPanel.Dock="Left" ItemsSource="{Binding Indexes}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <VirtualizingStackPanel />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemContainerStyle>
                                                    <Style TargetType="ContentPresenter">
                                                        <Setter Property="Height" Value="34"></Setter>
                                                    </Style>
                                                </ItemsControl.ItemContainerStyle>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding}" VerticalAlignment="Center"></TextBlock>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                            <ItemsPresenter />
                                        </DockPanel>
                                    </ScrollViewer>
                                </ControlTemplate>
                            </ListBox.Template>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}"></TextBlock>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem Header="MultiBinding(Items.Count)">
                        <ListBox
                            Padding="5"
                            AlternationCount="100000"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                            <TextBlock.Text>
                                                <MultiBinding
                                                    Converter="{StaticResource CollectionElementIndexConverter}"
                                                    StringFormat="{}{0}">
                                                    <Binding />
                                                    <Binding Path="DataContext.Items"
                                                             RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                    <Binding Path="DataContext.Items.Count"
                                                             RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem Header="MultiBinding(Binding Items)">
                        <ListBox
                            Padding="5"
                            AlternationCount="100000"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                            <TextBlock.Text>
                                                <MultiBinding
                                                    Converter="{StaticResource CollectionElementIndexConverter}"
                                                    StringFormat="{}{0}">
                                                    <Binding />
                                                    <Binding Path="DataContext.Items"
                                                             RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                </TabControl>
            </DockPanel>
        </TabItem>

        <!--  第二节课  -->
        <TabItem Header="ItemsControl1">
            <DockPanel>
                <Button
                    Width="200"
                    Height="70"
                    HorizontalAlignment="Left"
                    Command="{Binding RemoveCommand}"
                    Content="Remove"
                    DockPanel.Dock="Bottom" />
                <TabControl>
                    <TabItem Header="IndexConverter(ItemsControl)">
                        <ItemsControl Padding="5" ItemsSource="{Binding Items}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center"
                                            Text="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Converter={StaticResource IndexConverter}, StringFormat={}{0}}" />
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </TabItem>
                    <TabItem Header="IndexConverter(ListBox)">
                        <ListBox
                            Padding="5"
                            AlternationCount="100000"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center"
                                            Text="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Converter={StaticResource IndexConverter}, StringFormat={}{0}}" />
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem Header="MultiBinding">
                        <ListBox
                            Padding="5"
                            AlternationCount="100000"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                            <TextBlock.Text>
                                                <MultiBinding
                                                    Converter="{StaticResource CollectionElementIndexConverter}"
                                                    StringFormat="{}{0}">
                                                    <Binding />
                                                    <Binding Path="ItemsSource"
                                                             RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem Header="AlternationCount">
                        <ListBox
                            Padding="5"
                            AlternationCount="100000"
                            ItemsSource="{Binding Items}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="30" Orientation="Horizontal">
                                        <TextBlock
                                            Width="20"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center"
                                            Text="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=(ItemsControl.AlternationIndex), Converter={StaticResource OrdinalIndexConverter}, StringFormat={}{0:D2}}" />
                                        <TextBlock VerticalAlignment="Center" Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                </TabControl>
            </DockPanel>
        </TabItem>

        <!--  第一节课  -->
        <TabItem Header="ItemsControl">
            <TabControl>
                <TabItem Header="基础的 ItemsSource 绑定，奇偶行交替颜色，以及表头">

                    <!--  用来展示基础的 ItemsSource 绑定，奇偶行交替颜色，以及表头  -->
                    <ItemsControl
                        Grid.Column="0"
                        AlternationCount="2"
                        ItemsSource="{Binding Stars}">
                        <ItemsControl.Template>
                            <ControlTemplate TargetType="ItemsControl">
                                <DockPanel>
                                    <TextBlock DockPanel.Dock="Top" Text="Header" />
                                    <!-- <ItemsPresenter /> -->
                                    <StackPanel IsItemsHost="True" />
                                </DockPanel>
                            </ControlTemplate>
                        </ItemsControl.Template>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Name="CurrentBorder" Padding="10">
                                    <TextBlock Margin="0,5" Text="{Binding}" />
                                </Border>
                                <DataTemplate.Triggers>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                        <Setter TargetName="CurrentBorder" Property="Background" Value="LightGray" />
                                    </Trigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </TabItem>

                <TabItem Header="替换 ItemsPanel 为 Canvas，以及修改 ItemContainerStyle">
                    <!--  用来展示替换 ItemsPanel 为 Canvas，以及修改 ItemContainerStyle  -->
                    <ItemsControl Grid.Column="1" ItemsSource="{Binding Shapes}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Canvas.Left" Value="{Binding Pos.X}" />
                                <Setter Property="Canvas.Top" Value="{Binding Pos.Y}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Rectangle
                                    Name="Rect"
                                    Width="40"
                                    Height="40"
                                    Fill="{Binding Color}" />
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding Type}" Value="1">
                                        <Setter TargetName="Rect" Property="RadiusX" Value="20" />
                                        <Setter TargetName="Rect" Property="RadiusY" Value="20" />
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </TabItem>

                <TabItem Header="Resources 中存放多个 DataType 不同的 DataTemplate">
                    <!--  用于展示在 Resources 中存放多个 DataType 不同的 DataTemplate 的效果  -->
                    <ItemsControl
                        Grid.Column="2"
                        Padding="5"
                        VerticalAlignment="Top"
                        ItemsSource="{Binding Fruits}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="3" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.Resources>
                            <DataTemplate DataType="{x:Type local:Apple}">
                                <Border
                                    Height="{Binding RelativeSource={RelativeSource Self}, Path=ActualWidth}"
                                    Margin="5"
                                    Background="IndianRed"
                                    BorderBrush="Gray"
                                    BorderThickness="1">
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Text="{Binding Amount, StringFormat=Amount: {0}}" />
                                </Border>
                            </DataTemplate>
                            <DataTemplate DataType="{x:Type local:Banana}">
                                <Button
                                    Height="{Binding RelativeSource={RelativeSource Self}, Path=ActualWidth}"
                                    Margin="5"
                                    Background="Yellow"
                                    BorderBrush="Gray"
                                    BorderThickness="1">
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Text="{Binding Amount, StringFormat=Amount: {0}}" />
                                </Button>
                            </DataTemplate>
                        </ItemsControl.Resources>
                    </ItemsControl>
                </TabItem>

                <TabItem Header="DataTemplateSelector">
                    <!--  用于展示 DataTemplateSelector 的使用  -->
                    <ItemsControl
                        Grid.Column="3"
                        Padding="5"
                        VerticalAlignment="Top"
                        ItemsSource="{Binding Employees}">
                        <ItemsControl.ItemTemplateSelector>
                            <local:EmployeeTemplateSelector>
                                <local:EmployeeTemplateSelector.MaleTemplate>
                                    <DataTemplate>
                                        <Border Height="200" Background="LightBlue">
                                            <TextBlock Text="{Binding Name}" />
                                        </Border>
                                    </DataTemplate>
                                </local:EmployeeTemplateSelector.MaleTemplate>
                                <local:EmployeeTemplateSelector.FemaleTemplate>
                                    <DataTemplate>
                                        <Border Height="200" Background="LightPink">
                                            <TextBlock Text="{Binding Name}" />
                                        </Border>
                                    </DataTemplate>
                                </local:EmployeeTemplateSelector.FemaleTemplate>
                            </local:EmployeeTemplateSelector>
                        </ItemsControl.ItemTemplateSelector>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="3" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <!-- <ItemsControl.ItemTemplate> -->
                        <!--     <DataTemplate> -->
                        <!--         <Border Height="200"> -->
                        <!--             <TextBlock Text="{Binding Name}" /> -->
                        <!--         </Border> -->
                        <!--     </DataTemplate> -->
                        <!-- </ItemsControl.ItemTemplate> -->
                    </ItemsControl>
                </TabItem>
            </TabControl>
        </TabItem>
    </TabControl>

</Window>